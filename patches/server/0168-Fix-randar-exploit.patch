From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: HaHaWTH <id_cn00@outlook.com>
Date: Thu, 18 Apr 2024 18:31:50 +0800
Subject: [PATCH] Fix-randar-exploit

Credits: Leijurv (From https://github.com/spawnmason/randar-explanation/blob/master/media/0386-Patch-RNG-reuse-that-could-lead-to-coord-exploit-Ran.patch)

diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index 0d0a57fdd28568d880ad48576571ffe431389849..5466e01c8be056061d1522a39e3495a5ff64b81b 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -90,6 +90,7 @@ public abstract class World implements IBlockAccess {
     protected float q;
     private int M;
     public final Random random = new Random();
+    private final Random separateRandOnlyForWorldGen = new Random(); // Beast - Fix Randar
     public WorldProvider worldProvider;
     protected NavigationListener t = new NavigationListener();
     protected List<IWorldAccess> u;
@@ -3316,8 +3317,10 @@ public abstract class World implements IBlockAccess {
     public Random a(int i, int j, int k) {
         long l = (long) i * 341873128712L + (long) j * 132897987541L + this.getWorldData().getSeed() + (long) k;
 
-        this.random.setSeed(l);
-        return this.random;
+        // Beast start
+        this.separateRandOnlyForWorldGen.setSeed(l);
+        return this.separateRandOnlyForWorldGen;
+        // Beast end
     }
 
     public CrashReportSystemDetails a(CrashReport crashreport) {
